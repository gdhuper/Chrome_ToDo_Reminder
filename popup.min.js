var popup=function(){function e(e,t,n,i,o,a,l,r){console.log("creating task object"),this.tId=e,this.tName=t,this.tDueDate=n,this.tUrl=i,this.tNotes=o,this.tPriority=a,this.tNotify=l,this.tNotifyUrl=r}function t(){var t=!1;console.log("calling save task");var l,r=S.value,d=Y.value,g=J.value,v=M.value;l=null==T?"None":T;var k=function(){return $("#notifyCheckBox").is(":checked")?!0:!1}(),I=function(){return $("#notifyUrlCheckBox").is(":checked")?!0:!1}();if(!C)if(b+=1,""!=r)if(n(g))if(1==o(d)){var D=new e(b,r,d,g,v,l,k,I);s(D),a(D),c(D),h(D),p();var B=JSON.stringify(D);t=!0,$("#error-info").text(""),console.log("printing task details :"+B)}else if(console.log("invalid due time create task"),console.log("invalid due time edit task"),$("#taskForm").on("invalid.bs.validator",function(e){}),""!=time){var E=new Date,x=new Date(time);"Invalid Date"==x?$("#error-info").text("Invalid Date! Please enter a valid due date"):E>x&&(console.log("check valid time : curtime"+curtime),$("#error-info").text("Due date should be greater than current date"))}else $("#error-info").text("Due date cannot be empty!");else $("#error-info").text("Invalid URL!");else $("#error-info").text("Task name cannot be empty");if(C)if(console.log("in edit mode"),""!=r)if(n(g))if(1==o(d)){var N=new e(L,r,d,g,v,l,k,I),P=$("tr",F),_=P[U+1];console.log("updateing row "+_),console.log("tempIDforEdit"+U+" tempTaskToUpdate = "+L),_.innerHTML="<tr t-id='"+L+"'><td><a href='#' class='view'>"+r+"</a></td><td>"+d+"</td><td>"+l+"</td><td><a href='#' class='edit'>Edit </a><a href='#' class='del'>Delete</a></td></tr>",O[U]=N,C=!1,L=0,U=0,y(O),$(".view").off("click"),$(".view").on("click",f),$(".edit").off("click"),$(".edit").on("click",function(){var e=this;for(curId=$(e).parents("tr").attr("t-id"),i=0;i<O.length;i++)if(O[i].tId==curId){u(curId,curId);break}}),$(".del").off("click"),$(".del").on("click",m),w(),p(),t=!0,$("#error-info").text("")}else if(console.log("invalid due time edit task"),""!=time){var E=new Date,x=new Date(time);"Invalid Date"==x?$("#error-info").text("Invalid Date! Please enter a valid due date"):E>x&&(console.log("check valid time : curtime"+curtime),$("#error-info").text("Due date should be greater than current date"))}else $("#error-info").text("Due date cannot be empty!");else $("#error-info").text("Invalid URL!");else $("#error-info").text("Task name cannot be empty")}function n(e){var t=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g);return null==t?!1:!0}function o(e){if(""!=e){var t=new Date,n=new Date(e);return"Invalid Date"==n?"Invalid Date! Please enter a valid due date":t>n?(console.log("check valid time : curtime"+curtime),"Due date should be greater than current date"):(console.log("retjrn true"),!0)}return"Due date cannot be empty!"}function a(e){return null==e?(console.log("Empty Fields! Please input a task"),!1):l(e.tName)&&r(e.tDueDate)&&d(e.tUrl)?(console.log("all fields validated"),!0):void console.log("Non empty fields")}function l(e){return console.log("Calling validName"),!0}function r(e){return console.log("Calling validDueDate"),!0}function d(e){return console.log("Calling validUrl"),!0}function s(e){var t=JSON.stringify(e);console.log("printing task method \n"+t)}function c(e){$("#hiddenTaskList").addClass("hidden"),$("#taskList").append("<tr t-id='"+e.tId+"'><td><a href='#' class='view'>"+e.tName+"</a></td><td>"+e.tDueDate+"</td><td>"+e.tPriority+"</td><td><a href='#'  class='edit'>Edit </a><a href='#'  class='del'>Delete</a></td></tr>"),$(".view").off("click"),$(".view").on("click",f),$(".edit").off("click"),$(".edit").on("click",function(){var e=this;for(curId=$(e).parents("tr").attr("t-id"),i=0;i<O.length;i++)if(O[i].tId==curId){u(curId,curId);break}}),$(".del").off("click"),$(".del").on("click",m),w(),console.log("printing checked "+e.tNotify)}function u(e,t){console.log("Calling showEditForm task Id ="+e);var n=k(e);C=!0,S.value=n.tName,Y.value=n.tDueDate,J.value=n.tUrl,M.value=n.tNotes,j.value=n.tPriority;var o=n.tPriority+' <span class="caret"></span>';for($(".dropdown-menu").closest(".btn-group").find(".dropdown-toggle").html(o),1==n.tNotify&&$("#notifyCheckBox").prop("checked",!0),1==n.tNotifyUrl&&$("#notifyUrlCheckBox").prop("checked",!0),L=t,i=0;i<O.length;i++)O[i].tId==e&&(U=i);B(),$("#task-view").addClass("hidden")}function f(e){console.log("in viewTask"),e.preventDefault();var t=this;curId=$(t).parents("tr").attr("t-id"),console.log("viewing task id: "+curId);var n;for(i=0;i<O.length;i++)O[i].tId==curId&&(n=O[i]);n&&(Z.innerText=n.tName,H.innerText=n.tDueDate,q.innerText=n.tUrl,G.innerText=n.tNotes,K.innerText=n.tPriority,1==n.tNotify&&(console.log("in true"),$("#view_notifyCheckBox").prop("checked",!0)),1==n.tNotifyUrl&&$("#view_notifyUrlCheckBox").prop("checked",!0),Q.addEventListener("click",function(){console.log("calling editform with task id ="+n.tId+" and cur id "+curId),u(n.tId,curId)}),V.addEventListener("click",g),v())}function g(){Z.innerText="",H.innerText="",q.innerText="",G.innerText="",K="",$("#error-info").text(""),$("#task-view").addClass("hidden"),$("#frontPanel").removeClass("hidden"),$("#topTitle").removeClass("hidden")}function v(){$("#task-view").removeClass("hidden"),$("#frontPanel").addClass("hidden"),$("#topTitle").addClass("hidden")}function m(e){e.preventDefault();var t=this;bootbox.confirm({message:"Delete Task ?",buttons:{confirm:{label:"Yes",className:"btn-danger"},cancel:{label:"No",className:"btn-success"}},callback:function(e){if(e){for(curId=$(t).parents("tr").attr("t-id"),console.log("in del temp: id : "+curId),$(t).parents("tr").remove(),i=0;i<O.length;i++)if(O[i].tId==curId){O.splice(i,1);break}if(y(O),0==O.length)return b=0,$("#hiddenTaskList").removeClass("hidden"),void y(O)}else console.log("dont delete task")}})}function k(e){for(i=0;i<O.length;i++)if(O[i].tId==e)return O[i]}function h(e){console.log("pushing task to array list"),O.push(e),y(O)}function p(){console.log("calling displayTasks"),$("#frontPanel").removeClass("hidden"),$("#topTitle").removeClass("hidden"),$("#addTask").addClass("hidden"),w()}function y(e){return F?void chrome.storage.local.set({list:e},function(){console.log("tasks saved in storage")}):void message("Error: No value specified")}function I(){console.log("loading data");var e;chrome.storage.local.get("list",function(t){e=JSON.stringify(t),D(e),console.log("printing objs in loadData "+e)})}function D(t){console.log("printint tasks from gettask "+t);var n=JSON.parse(t);if(void 0==n.list)return void console.log("No tasks to load!");for(var i=0;i<n.list.length;i++){var o=n.list[i],a=o.tId,l=o.tName,r=o.tDueDate,d=o.tUrl,s=o.tNotes,u=o.tPriority,f=o.tNotify,g=o.tNotifyUrl,v=new e(a,l,r,d,s,u,f,g);c(v),h(v),p(),b+=1}}function w(){console.log("reseting form"),document.getElementById("taskForm").reset(),$("#notifyCheckBox").attr("checked",!1),$("#notifyUrlCheckBox").attr("checked",!1);var e='None <span class="caret"></span>';$(".dropdown-menu").closest(".btn-group").find(".dropdown-toggle").html(e)}function B(){$("#frontPanel").addClass("hidden"),$("#topTitle").addClass("hidden"),$("#addTask").removeClass("hidden")}function E(){$("#dueDateTime").datetimepicker({format:"MM/DD/YYYY  hh:mm A",showClose:!0,keepOpen:!1,keepInvalid:!1})}function x(){E(),I()}var N,C=!1,T=null,b=0,U=0,L=0,P=document,O=[],_=(P.getElementById("topTitle"),P.getElementById("createTask")),F=(P.getElementById("frontPanel"),P.getElementById("taskList")),S=(P.getElementById("addTask"),P.getElementById("inputTaskName")),Y=P.getElementById("inputDueTime"),J=P.getElementById("basic-url"),M=P.getElementById("taskNotes"),j=P.getElementById("pButton"),z=(P.getElementById("notifyCheckBox"),P.getElementById("notifyUrlCheckBox"),P.getElementById("calIcon")),A=P.getElementById("cancelSave"),R=P.getElementById("saveTask"),Z=P.getElementById("view-task-name"),H=P.getElementById("view-task-dueDate"),q=P.getElementById("view-task-url"),G=P.getElementById("view-task-notes"),K=P.getElementById("view-priority"),Q=(P.getElementById("view_notifyCheckBox"),P.getElementById("view_notifyUrlCheckBox"),P.getElementById("edit-task")),V=P.getElementById("cancel-view");return _.addEventListener("click",B),z.addEventListener("click",E),A.addEventListener("click",p),R.addEventListener("click",t),$(".dropdown-menu").on("click","a",function(){console.log("changing button text");var e=$(this).html();console.log(e),T=e;var t=e+' <span class="caret"></span>';$(this).closest(".btn-group").find(".dropdown-toggle").html(t)}),$("#taskForm").validator(N),x()};document.addEventListener("DOMContentLoaded",function(){popup()});
